---
layout: post
title:  "tiles 1"
thumbnail: "template.png"
---
<canvas class="draw-target"></canvas>
<script>
function resize(ctx, w, h) {
    var tw = 240;
    var th = tw * Math.sin(2 * Math.PI / 3);
    var n_tilex = Math.ceil(w / tw);
    var n_tiley = Math.ceil(h / th);
    var tcanvas = document.createElement('canvas');
    tcanvas.width = tw;
    tcanvas.height = th;
    var tctx = tcanvas.getContext('2d');
    for(var i = 0; i < n_tilex; i++) {
    	for(var j = 0; j < n_tiley; j++) {
		    updateTile(tctx, tw, th, 10);
		    ctx.drawImage(tcanvas, i * tw, j * th);
		    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
		    ctx.strokeRect(i * tw, j * th, tw, th);
		}
    }
}

function updateTile(ctx, w, h, ntile) {
	// var colors = ['rgb()', 'rgb()', 'rgb()', 'rgb()', 'rgb()'];
	var colors = ['rgb(0,47,69)', 'rgb(0,172,182)', 'rgb(159,190,194)', 'rgb(245,103,114)', 'rgb(232,0,84)'];
	// var colors = ['rgb(231,174,155)', 'rgb(200,72,95)', 'rgb(137,203,199)', 'rgb(201,179,165)', 'rgb(248,235,216)'];
	// var colors = ['rgb(224,220,193)', 'rgb(244,219,199)', 'rgb(232,182,159)', 'rgb(227,198,156)'];
	// var colors = ['rgb()', 'rgb()', 'rgb()', 'rgb()', 'rgb()'];
	var zones = [];
	for(var i = 0; i < colors.length * 1.5; i++) {
		zones.push({x: Math.random() * 1.5 - 0.25, y: Math.random() * 1.5 - 0.25, color: colors[i % colors.length]});
	}

	var length = w / ntile;
	var sides = 3;

	var width = length;
	var height = length * Math.sin(2 * Math.PI / sides);

	var x = -width / 2;
	var y = height;
	
	var n_col = Math.ceil((w + width) / width * 2);
	var n_row = Math.ceil(h / height);

	for (var row = 0; row < n_row; row++) {
		var row_x = x;
		var row_y = y + (height * row);

		for(var col = 0; col < n_col; col++) {
			var color = peekColor(col / n_col, row / n_row, zones, colors);
			var col_x = row_x + (width / 2) * col;
			var col_y = row_y;
			var dir = (row + col) % 2 == 0 ? 1 : -1;
			var y_offset = (row + col) % 2 == 0 ? col_y : col_y - height;
 			polygon(ctx, col_x, y_offset, sides, length, color, dir);
		}
	}
}

function polygon(ctx, x, y, sides, length, color, dir) {
	var angle = 2 * Math.PI / sides;
	ctx.beginPath();
	ctx.moveTo(x, y);
	for(var i = 0; i < sides; i++) {
		x = x - length * Math.cos(Math.PI - angle * i * dir);
		y = y - length * Math.sin(Math.PI - angle * i * dir);
		ctx.lineTo(x, y);
	}
	ctx.fillStyle = color;
	ctx.strokeStyle = 'rgba(255,255,255,0.2)';
	ctx.fill();
	ctx.stroke();
}

function peekColor(x, y, zones, colors) {
	var infls = [];
	for(var i = 0; i < zones.length; i++) {
		var zone = zones[i];
		infls.push(Math.pow(1 - distance(x, y, zone.x, zone.y), 8));
	}
	var sum = 0;
	for(var i = 0; i < infls.length; i++) {
		sum += infls[i];
	}
	var dart = Math.random() * sum;
	var pos = 0;
	for(var i = 0; i < infls.length - 1; i++) {
		pos += infls[i];
		if(dart < pos) return zones[i].color;
	}
	return zones[zones.length - 1].color;
}

function distance(x1, y1, x2, y2) {
	return Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
}

// window.addEventListener('load', main);
// var canvases;
// var bg_canvas;
// var bg_ctx;
// var w;
// var h;

// function main() {
// 	var bg = document.querySelector('#bg');
// 	w = bg.width;
// 	h = bg.height;

// 	canvases = document.querySelectorAll('.canvas');
// 	for(var i = 0; i < canvases.length; i++) {
// 		canvases[i].width = w;
// 		canvases[i].height = h;
// 		canvases[i].addEventListener('click', function(e) {
// 			update(e.target.getContext('2d'));
// 		});
// 	}

// 	bg_canvas = document.querySelector('#bg_canvas');
// 	bg_canvas.width = w;
// 	bg_canvas.height = h;
// 	bg_ctx = bg_canvas.getContext('2d');

// 	bg_ctx.drawImage(bg, 0, 0);

// 	for(var i = 0; i < canvases.length; i++) {
// 		update(canvases[i].getContext('2d'));
// 	}
// }

// function get_pixel(img_data, x, y, w) {
// 	if(x >= w) {
// 		x = w - 1;
// 	}

// 	var base = (w * 4 * y) + (4 * x);
// 	return [
// 		img_data[base + 0], 
// 		img_data[base + 1],
// 		img_data[base + 2],
// 		img_data[base + 3]
// 	];
// }
</script>
